{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\WOW\\\\Documents\\\\GitHub\\\\react\\\\react-test\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _objectSpread from\"C:\\\\Users\\\\WOW\\\\Documents\\\\GitHub\\\\react\\\\react-test\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import{authAPI,securityAPI,profileAPI}from'../API/api';import{stopSubmit}from'redux-form';import*as authR from'./auth-reducer.js';export var SET_USER='auth-reducer/SET_USER';export var RESET_USER='auth-reducer/RESET_USER';export var GET_CAPTHCA_SUCCESS='auth-reducer/GET_CAPTHCA_SUCCESS';export var SET_AVATAR='auth-reducer/SET_AVATAR';var initialState={id:null,email:null,login:null,isAuth:false,captchaURL:null,avatar:null};export var authReducer=function authReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case SET_USER:return _objectSpread({},state,{},action.payload,{isAuth:true});case GET_CAPTHCA_SUCCESS:return _objectSpread({},state,{captchaURL:action.payload});case RESET_USER:return _objectSpread({},initialState);case SET_AVATAR:return _objectSpread({},state,{},action.payload);default:return state;}};export var setUserAuth=function setUserAuth(data){return{type:SET_USER,payload:_objectSpread({},data)};};export var resetUserAuth=function resetUserAuth(){return{type:RESET_USER};};export var setCaptcha=function setCaptcha(captchaURL){return{type:GET_CAPTHCA_SUCCESS,payload:captchaURL};};export var setAvatar=function setAvatar(avatar){return{type:SET_AVATAR,payload:{avatar:avatar}};};export var getAuthThunk=function getAuthThunk(){return function _callee(dispatch){var data,response;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regeneratorRuntime.awrap(authAPI.getAuth());case 2:data=_context.sent;if(!(data.resultCode===0)){_context.next=9;break;}dispatch(setUserAuth(data.data));_context.next=7;return _regeneratorRuntime.awrap(profileAPI.getProfile(data.data.id));case 7:response=_context.sent;dispatch(setAvatar(response.data.photos.small));case 9:case\"end\":return _context.stop();}}});};};export var logInThunk=function logInThunk(dataForm){return function _callee2(dispatch){var data,messages;return _regeneratorRuntime.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _regeneratorRuntime.awrap(authAPI.logIn(dataForm));case 2:data=_context2.sent;if(!(data.resultCode===0)){_context2.next=8;break;}_context2.next=6;return _regeneratorRuntime.awrap(dispatch(authR.getAuthThunk(data.data)));case 6:_context2.next=11;break;case 8:if(data.resultCode===10){dispatch(getCaptcha());}messages=data.messages.length?data.messages[0]:'Some error';dispatch(stopSubmit('login',{_error:messages}));case 11:case\"end\":return _context2.stop();}}});};};export var getCaptcha=function getCaptcha(){return function _callee3(dispatch){var response,captcha;return _regeneratorRuntime.async(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _regeneratorRuntime.awrap(securityAPI.getCaptcha());case 2:response=_context3.sent;captcha=response.url;dispatch(setCaptcha(captcha));case 5:case\"end\":return _context3.stop();}}});};};export var logOutThunk=function logOutThunk(){return function _callee4(dispatch){var data;return _regeneratorRuntime.async(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return _regeneratorRuntime.awrap(authAPI.logOut());case 2:data=_context4.sent;if(data.resultCode===0){dispatch(resetUserAuth());}case 4:case\"end\":return _context4.stop();}}});};};export default authReducer;","map":{"version":3,"sources":["C:/Users/WOW/Documents/GitHub/react/react-test/src/redux/auth-reducer.js"],"names":["authAPI","securityAPI","profileAPI","stopSubmit","authR","SET_USER","RESET_USER","GET_CAPTHCA_SUCCESS","SET_AVATAR","initialState","id","email","login","isAuth","captchaURL","avatar","authReducer","state","action","type","payload","setUserAuth","data","resetUserAuth","setCaptcha","setAvatar","getAuthThunk","dispatch","getAuth","resultCode","getProfile","response","photos","small","logInThunk","dataForm","logIn","getCaptcha","messages","length","_error","captcha","url","logOutThunk","logOut"],"mappings":"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","sourcesContent":["import { authAPI, securityAPI, profileAPI } from '../API/api';\r\nimport { stopSubmit } from 'redux-form';\r\n\r\nimport * as authR from './auth-reducer.js'\r\n\r\nexport const SET_USER = 'auth-reducer/SET_USER'\r\nexport const RESET_USER = 'auth-reducer/RESET_USER'\r\nexport const GET_CAPTHCA_SUCCESS = 'auth-reducer/GET_CAPTHCA_SUCCESS'\r\nexport const SET_AVATAR = 'auth-reducer/SET_AVATAR'\r\n\r\nconst initialState = {\r\n    id: null,\r\n    email: null,\r\n    login: null,\r\n    isAuth: false,\r\n    captchaURL: null,\r\n    avatar: null\r\n}\r\n\r\nexport const authReducer = (state = initialState, action) => {\r\n\r\n    switch (action.type) {\r\n        case SET_USER:\r\n            return {\r\n                ...state,\r\n                ...action.payload,\r\n                isAuth: true\r\n            }\r\n        case GET_CAPTHCA_SUCCESS: \r\n            return {\r\n                ...state,\r\n                captchaURL: action.payload\r\n            }     \r\n        case RESET_USER:\r\n            return {\r\n                ...initialState\r\n            }\r\n        case SET_AVATAR:\r\n            return {\r\n                ...state,\r\n                ...action.payload\r\n            }    \r\n        default: return state;\r\n\r\n    }\r\n\r\n}\r\n\r\nexport const setUserAuth = (data) => ({ type: SET_USER, payload: {...data} });\r\nexport const resetUserAuth = () => ({ type: RESET_USER });\r\nexport const setCaptcha = (captchaURL) => ({ type: GET_CAPTHCA_SUCCESS, payload: captchaURL })\r\nexport const setAvatar = (avatar) => ({type: SET_AVATAR, payload: {avatar}})\r\nexport const getAuthThunk = () => async (dispatch) => {\r\n    const data =  await (authAPI.getAuth())\r\n    if ( data.resultCode === 0) {\r\n        dispatch(setUserAuth(data.data));\r\n        const response = await profileAPI.getProfile(data.data.id);\r\n        dispatch(setAvatar(response.data.photos.small))\r\n    }\r\n\r\n}\r\nexport const logInThunk = (dataForm) => async (dispatch) => {\r\n    const data = await authAPI.logIn(dataForm)\r\n\r\n    if (data.resultCode === 0) {\r\n        await dispatch(authR.getAuthThunk(data.data))\r\n\r\n    } else {\r\n        if(data.resultCode === 10){\r\n            dispatch(getCaptcha())\r\n        }\r\n        let messages = data.messages.length ? data.messages[0] : 'Some error'\r\n        dispatch(stopSubmit('login', { _error: messages }))\r\n    }\r\n}\r\n\r\n\r\nexport const getCaptcha = () => async (dispatch) => {\r\n   const response = await(securityAPI.getCaptcha())\r\n   const captcha = response.url\r\n   dispatch(setCaptcha(captcha))\r\n}\r\nexport const logOutThunk = () => async (dispatch) => {\r\n    const data = await (authAPI.logOut())\r\n    if (data.resultCode === 0) {\r\n        dispatch(resetUserAuth());\r\n    }\r\n}\r\n\r\n\r\nexport default authReducer;"]},"metadata":{},"sourceType":"module"}